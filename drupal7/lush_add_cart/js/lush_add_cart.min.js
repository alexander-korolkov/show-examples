"use strict";!function(a){Drupal.behaviors.lushAddCart={attach:function(a,t){},addCartButton:function(){a(".node-add-to-basket").each(function(){var t=a(this).find(".product-module-price-rating");t.find(".add-cart-button").length<1&&t.append(a("<div class='add-cart-button' />"))})},KitchenaddAartButton:function(){a(".header-products-contents li.last, .header-sub-menu-products li.kitchen").click(function(){a("body").addClass("absolute_header")&&a(".object-shelf-right").find(".add-cart-button").length<1&&setTimeout(function(){Drupal.behaviors.lushAddCart.addCartButton()},1e3)})},naviplusAddCartButton:function(){"complete"==document.readyState&&setTimeout(function(){Drupal.behaviors.lushAddCart.addCartButton()},2e3)},lushAddCartPopup:function(){a("body").on("click",".node-add-to-basket .add-cart-button",function(){a(".add-cart-button .throbber").remove(),a(this).parents(".node-add-to-basket").find(".review-super-wrapper,.highlighted-review-wrapper").removeAttr("style"),a(this).append(" <div class='throbber' /> ");var t=a(this).parents(".node-add-to-basket"),e=a(this).parents(".node-add-to-basket"),s=e.find(".product-super-wrapper"),r=e.find(".object-shelf-right-product");s.length>0?e=s:r.length>0&&(e=r);var d=t.attr("class").match(/nid-\d+/g)[0].split("-")[1];a.ajax({type:"post",url:Drupal.settings.basePath+"lush/product/ajax",data:{nid:d},dataType:"json",cache:!1,success:function(t){a(".add-cart-button .throbber").remove(),a(".add-cart-box").remove(),a(".add-cart-button").removeAttr("style"),e.find(".add-cart-button").attr("style","z-index:10"),e.find(".add-cart-box").length<1&&(e.append(t),a(".add-cart-box .product-image img").each(function(){a(this).width()>a(this).height()&&a(this).css("margin-top","4px")}))},error:function(){a(".add-cart-button .throbber").remove()}})})},lushAddCartWishlist:function(){a("body").on("click",".add-cart-box .wishlist",function(t){t.preventDefault();var e=a(this).attr("href"),s=a(this).parents(".add-cart-box"),r=s.find(".lush-cart-wishlist"),d=window.location.pathname;return a.ajax({type:"post",url:Drupal.settings.basePath+"lush/flag/ajax",data:{href:e,url:d},dataType:"json",cache:!1,success:function(t){if(void 0==t.message)r.html(t.wishlist);else{var e=a("<div class='add-success-box'><div class='success-message errors'>"+Drupal.t(t.message)+"</div><div class='close' style='right:0'>x</div></div>");s.html(Drupal.t(e)),s.parents(".node-add-to-basket").find(".review-super-wrapper,.highlighted-review-wrapper").css("z-index","0")}}}),!1})},lushAddCartSelectChange:function(){a("body").on("change",".add-cart-box select",function(){var t=a(this).parents(".node-add-to-basket"),e=t.find(".add-cart-box form"),s=e.serializeArray();return a.ajax({type:"post",url:Drupal.settings.basePath+"lush/product/change/ajax",data:{obj:s},dataType:"json",cache:!1,success:function(a){var e=a.image,s=Drupal.t(a.submit_value);0==!e&&(t.find(".object-commerce-image-inner-inner a").html(e),t.find(".form-submit-box").length>0?t.find(".form-submit-box").html(s):t.find(".coming-soon-box").length>0&&(t.find(".coming-soon-box").remove(),t.find(".form-type-textfield").after("<div class='form-submit-box'>"+s+"</div>")))}}),!1})},lushAddCartFormSubmit:function(){a("body").on("click",".add-cart-box .form-submit",function(t){t.preventDefault();var e=a(this).parents(".add-cart-box"),s=e.find("form"),r=s.serializeArray();return a.ajax({type:"post",url:Drupal.settings.basePath+"lush/product/submit/ajax",data:{obj:r},dataType:"json",cache:!1,success:function(t){if("Microsoft Internet Explorer"==navigator.appName&&"9."==navigator.appVersion.match(/9./i))var s=a("<div class='add-success-box'><div class='success-message'><span class='successIcon2'><embed src='/sites/all/modules/custom/lush_add_cart/img/confirmation-tick.swf' quality='high' wmode='transparent' width='100%' height='100%' type='application/x-shockwave-flash' /></span><div class='message'>"+Drupal.t(t.message)+"</div></div></div>");else var s=a("<div class='add-success-box'><div class='success-message'><span class='successIcon'/><div class='message'>"+Drupal.t(t.message)+"</div></div></div>");for(var r in t.errors)var d=Drupal.t(t.errors[r]);var o=a("<div class='add-success-box'><div class='errors'>"+d+"</div><div class='close' style='right:0'>x</div></div>");e.parents(".node-add-to-basket").find(".review-super-wrapper,.highlighted-review-wrapper").css("z-index","0"),void 0==t.errors?(e.html(s),a("body").addClass("add-success"),setInterval(function(){e.fadeOut("slow")},2e3)):(e.find(".submit-errors").remove(),e.html(o));var i=window.dataLayer||[];if(t.dataLayer){var n;for(n in t.dataLayer)t.dataLayer.hasOwnProperty(n)&&i.push(t.dataLayer[n])}}}),!1})},UpdateRightSideCart:function(){if(a("#loadA").length<1){var t=a("<a href='/lush-basket' id='loadA' class='use-ajax'/>");a(".blackboard").append(t)}a("body").on("click",".header-cart a",function(){a("body").hasClass("add-success")&&(a("body").hasClass("slideout-open")&&a(".object-cart-slideout-wrapper .view-lush-shopping-cart-block").remove(),a("#loadA").trigger("click"),a("body").removeClass("add-success"))})},closeAddCartBox:function(){a("body").on("click",".add-cart-box .close",function(){a(this).parents(".add-cart-box").remove(),a(".add-cart-button .throbber").remove(),a(".add-cart-button").removeAttr("style"),a(".node-add-to-basket").find(".review-super-wrapper,.highlighted-review-wrapper").removeAttr("style")})}},a(document).ready(function(){Drupal.behaviors.lushAddCart.lushAddCartPopup(),Drupal.behaviors.lushAddCart.lushAddCartWishlist(),Drupal.behaviors.lushAddCart.lushAddCartSelectChange(),Drupal.behaviors.lushAddCart.UpdateRightSideCart(),Drupal.behaviors.lushAddCart.closeAddCartBox(),Drupal.behaviors.lushAddCart.addCartButton(),document.onreadystatechange=Drupal.behaviors.lushAddCart.naviplusAddCartButton,a("body").hasClass("page-search")&&setInterval("Drupal.behaviors.lushAddCart.addCartButton();",1e3),Drupal.behaviors.lushAddCart.lushAddCartFormSubmit(),Drupal.behaviors.lushAddCart.KitchenaddAartButton()})}(jQuery);
